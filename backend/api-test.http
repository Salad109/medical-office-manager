### Variables
@baseUrl = http://localhost:8080/api
@receptionistToken =
@patientToken =
@doctorToken =

### Note: First receptionist must be created manually in database

### Login as receptionist
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "receptionist1",
  "password": "password123"
}

# Copy token from response and update @receptionistToken above

### ===== USER MANAGEMENT (Receptionist only) =====

### Create patient account
POST {{baseUrl}}/users
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "username": "patient1",
  "password": "password123",
  "firstName": "Jan",
  "lastName": "Kowalski",
  "phoneNumber": "123456789",
  "pesel": "12345678901",
  "role": "PATIENT"
}

### Create doctor account
POST {{baseUrl}}/users
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "username": "doctor1",
  "password": "password123",
  "firstName": "Janina",
  "lastName": "Nowak",
  "phoneNumber": "987654321",
  "pesel": "98765432109",
  "role": "DOCTOR"
}

### Create another receptionist account
POST {{baseUrl}}/users
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "username": "receptionist2",
  "password": "password123",
  "firstName": "Grzegorz",
  "lastName": "BrzÄ™czyszczykiewicz",
  "phoneNumber": "555123456",
  "pesel": "55512345678",
  "role": "RECEPTIONIST"
}

### Get all users (paginated)
GET {{baseUrl}}/users?page=0&size=10
Authorization: Bearer {{receptionistToken}}

### Get user by ID
GET {{baseUrl}}/users/1
Authorization: Bearer {{receptionistToken}}

### Update user
PUT {{baseUrl}}/users/1
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "username": "patient1",
  "password": "newpassword123",
  "firstName": "Jan",
  "lastName": "Kowalski-Updated",
  "phoneNumber": "123456789",
  "pesel": "12345678901",
  "role": "PATIENT"
}

### ===== AUTHENTICATION =====

### Login as patient
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "patient1",
  "password": "password123"
}

# Copy token and update @patientToken

### Login as doctor
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "doctor1",
  "password": "password123"
}

# Copy token and update @doctorToken

### ===== APPOINTMENTS =====

### View available slots (public, no auth required)
GET {{baseUrl}}/appointments/available?date=2025-11-01

### Book appointment as patient (for self only)
POST {{baseUrl}}/appointments
Authorization: Bearer {{patientToken}}
Content-Type: application/json

{
  "patientId": 1,
  "date": "2025-11-01",
  "time": "09:00"
}

### Patient tries to book for another patient (should fail with 403)
POST {{baseUrl}}/appointments
Authorization: Bearer {{patientToken}}
Content-Type: application/json

{
  "patientId": 2,
  "date": "2025-11-01",
  "time": "09:30"
}

### Receptionist books appointment for any patient
POST {{baseUrl}}/appointments
Authorization: Bearer {{receptionistToken}}
Content-Type: application/json

{
  "patientId": 1,
  "date": "2025-11-01",
  "time": "10:00"
}

### Patient cancels own appointment
DELETE {{baseUrl}}/appointments/1
Authorization: Bearer {{patientToken}}

### Receptionist cancels any appointment
DELETE {{baseUrl}}/appointments/2
Authorization: Bearer {{receptionistToken}}

### Doctor tries to book appointment (should fail with 403)
POST {{baseUrl}}/appointments
Authorization: Bearer {{doctorToken}}
Content-Type: application/json

{
  "patientId": 1,
  "date": "2025-11-01",
  "time": "11:00"
}

### ===== VISITS (Doctor only) =====

### Get patient visit history
GET {{baseUrl}}/visits/patient/1
Authorization: Bearer {{doctorToken}}

### Mark appointment as completed (create visit)
POST {{baseUrl}}/visits
Authorization: Bearer {{doctorToken}}
Content-Type: application/json

{
  "appointmentId": 3,
  "notes": "Patient notes here."
}

### Update visit notes
PUT {{baseUrl}}/visits/1
Authorization: Bearer {{doctorToken}}
Content-Type: application/json

{
  "notes": "Updated patient notes here."
}

### ===== ERROR CASES =====

### Patient tries to access all users (should fail with 403)
GET {{baseUrl}}/users
Authorization: Bearer {{patientToken}}

### Patient tries to create user (should fail with 403)
POST {{baseUrl}}/users
Authorization: Bearer {{patientToken}}
Content-Type: application/json

{
  "username": "hacker",
  "password": "password123",
  "firstName": "Bad",
  "lastName": "Actor",
  "phoneNumber": "111111111",
  "role": "RECEPTIONIST"
}

### Doctor tries to cancel appointment (should fail with 403)
DELETE {{baseUrl}}/appointments/3
Authorization: Bearer {{doctorToken}}

### Patient tries to view visit history (should fail with 403)
GET {{baseUrl}}/visits/patient/1
Authorization: Bearer {{patientToken}}

### Patient tries to mark visit as completed (should fail with 403)
POST {{baseUrl}}/visits
Authorization: Bearer {{patientToken}}
Content-Type: application/json

{
  "appointmentId": 4,
  "notes": "Fake notes"
}